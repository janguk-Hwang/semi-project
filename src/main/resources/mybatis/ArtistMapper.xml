<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.ArtistMapper">
    <!-- 아티스트 이름으로 저장된 앨범 목록 조회 -->
    <select id="selectAlbumsByArtist" resultType="ArtistAlbumDto">
        SELECT album_mbid as albumMBID, title, album_type as type,
        release_date as releaseDate, cover_image_url as coverImageUrl
        FROM artist_albums
        WHERE artist_name = #{artistName}
        ORDER BY release_date DESC
    </select>

    <!-- 특정 앨범의 트랙 목록 조회 -->
    <select id="selectTracksByAlbum" resultType="TrackDto">
        SELECT track_number as "number", track_title as title
        FROM album_tracks
        WHERE album_mbid = #{albumMbid}
        ORDER BY track_id ASC
    </select>

    <insert id="insertAlbums">
        INSERT INTO artist_albums (album_mbid, artist_name, title, album_type, release_date, cover_image_url)
        VALUES (#{album.albumMBID}, #{name}, #{album.title}, #{album.type}, #{album.releaseDate}, #{album.coverImageUrl})
    </insert>

    <!-- 트랙 저장 시 앨범 ID와 트랙 정보를 함께 저장하도록 수정 -->
    <insert id="insertTrack">
        INSERT INTO album_tracks (album_mbid, track_number, track_title)
        VALUES (#{albumMbid}, #{track.number}, #{track.title})
    </insert>

    <select id="selectAllArtists" resultType="String">
        SELECT DISTINCT artist_name FROM artist_albums ORDER BY artist_name
    </select>
</mapper>