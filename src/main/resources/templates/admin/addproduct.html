<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>addproduct.html</title>
  <link rel="stylesheet" th:href="@{/landing.css}">
  <link rel="stylesheet" th:href="@{/admin-addproduct.css}">
</head>
<body>
<!-- header -->
<div th:replace="~{fragments/layout :: header}"></div>

<th:block th:replace="~{fragments/layout :: getMain(~{::#homeContent})}">
  <div id="homeContent">

    <!-- ìƒë‹¨ ê´€ë¦¬ì íƒ­ -->
    <nav class="pm-tabs">
      <a class="tab" th:href="@{/admin/main}">ì „ì²´ê´€ë¦¬</a>
      <a class="tab" th:href="@{/admin/board}">ê²Œì‹œë¬¼ê´€ë¦¬</a>
      <a class="tab is-active" th:href="@{/admin/product}">ìƒí’ˆê´€ë¦¬</a>
      <a class="tab" th:href="@{/admin/stock}">ì¬ê³ ê´€ë¦¬</a>
      <a class="tab" th:href="@{/admin/usermanagement}">íšŒì›ê´€ë¦¬</a>
      <a class="tab" th:href="@{/admin/artistmanagement}">ì•„í‹°ìŠ¤íŠ¸ê´€ë¦¬</a>
    </nav>

    <!-- í˜ì´ì§€ íƒ€ì´í‹€ -->
    <h2 class="page-title">ìƒí’ˆ ì¶”ê°€</h2>

    <!-- ìƒí’ˆ ë“±ë¡ í¼ (ì´ë¯¸ì§€ ì—…ë¡œë“œ í¬í•¨) -->
    <form class="product-form"
          th:action="@{/admin/product/new}"
          method="post"
          enctype="multipart/form-data">

      <!-- Product Name -->
      <div class="form-row">
        <label class="form-label" for="product_Name">Product Name :</label>
        <input class="form-input" id="product_Name" name="product_name" type="text" required>
      </div>

      <!-- Description -->
      <div class="form-row">
        <label class="form-label" for="description">Description :</label>
        <textarea class="form-textarea" id="description" name="description" rows="8"></textarea>
      </div>

      <!-- Upload Images -->
      <div class="form-section">
        <div class="section-title">Upload Images</div>

        <!-- ë“œë˜ê·¸/ë“œë UIëŠ” CSSë¡œ ê¾¸ë¯¸ê³ , ì‹¤ì œ ì—…ë¡œë“œëŠ” input(file)ë¡œ -->
        <label class="dropzone" for="images">
          <div class="dropzone-inner" id="dropzoneText">
            <div class="dropzone-icon">ğŸ–¼ï¸</div>
            <div class="dropzone-text">
              Drop your files here or <span class="link">browse</span>
            </div>
            <div class="dropzone-sub">Maximum size: 500MB</div>
          </div>

          <!-- âœ… ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
          <div class="dropzone-preview" id="dropzonePreview"></div>
        </label>

        <input id="images" name="file1" type="file" accept="image/*" multiple hidden>

      </div>

      <!-- Pricing & Stock -->
      <div class="form-section">
        <div class="section-title">Pricing &amp; Stock</div>

        <div class="form-row">
          <label class="form-label" for="price">íŒë§¤ê°€ :</label>
          <input class="form-input small" id="price" name="price" type="number" min="0" step="1" required>
        </div>


        <div class="form-row">
          <label class="form-label" for="stock">ì¬ê³ ìˆ˜ëŸ‰ :</label>
          <input class="form-input small" id="stock" name="stock" type="number" min="0" step="1">
        </div>
      </div>

      <!-- Category & Options -->
      <div class="form-section">
        <div class="section-title">Category &amp; Options</div>

        <div class="form-row">
          <label class="form-label" for="product_type">ì¹´í…Œê³ ë¦¬ :</label>
          <select class="form-input small"
                  id="product_type"
                  name="product_type">
            <option value="">ì¹´í…Œê³ ë¦¬ ì„¤ì •</option>
            <option value="md">MD</option>
            <option value="album">ALBUM</option>
            </select>
        </div>

        <div class="form-row">
          <label class="form-label" for="artistOption">ë®¤ì§€ì…˜ ì˜µì…˜ :</label>
          <select class="form-input small"
                  id="artistOption"
                  name="artist_id">
            <option value="">ë®¤ì§€ì…˜ ì„ íƒ</option>

            <option th:each="artist : ${musician}"
                    th:value="${artist.artist_id}"
                    th:text="${artist.artist_name}">
            </option>
          </select>
        </div>


        <div class="form-section">
          <div class="section-title">ì¶”ê°€ ì˜µì…˜</div>

          <div id="optionList"></div>

          <button type="button" class="btn btn-ghost" id="addOptionBtn">ì˜µì…˜ ì¶”ê°€</button>
        </div>


        <!-- ë²„íŠ¼ -->
      <div class="form-actions">
        <a class="btn btn-ghost" th:href="@{/admin/product}">ì·¨ì†Œ</a>
        <button class="btn btn-dark" type="submit">ì €ì¥</button>
      </div>
      </div>
    </form>
  </div>
</th:block>



<!-- footer -->
<div th:replace="~{fragments/layout :: footer}"></div>
<script>
  document.addEventListener("DOMContentLoaded", () => {

    // =========================
    // 1) ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
    // =========================
    const input = document.getElementById("images");
    const preview = document.getElementById("dropzonePreview");
    const dropzone = document.querySelector(".dropzone");

    function render(files) {
      preview.innerHTML = "";

      if (!files || files.length === 0) {
        dropzone.classList.remove("has-preview");
        return;
      }

      dropzone.classList.add("has-preview");

      Array.from(files).forEach((file) => {
        if (!file.type.startsWith("image/")) return;

        const url = URL.createObjectURL(file);
        const item = document.createElement("div");
        item.className = "dz-item";

        const img = document.createElement("img");
        img.src = url;
        img.alt = file.name;
        img.onload = () => URL.revokeObjectURL(url);

        item.appendChild(img);
        preview.appendChild(item);
      });
    }

    input.addEventListener("change", (e) => render(e.target.files));

    dropzone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropzone.classList.add("is-dragover");
    });

    dropzone.addEventListener("dragleave", () => {
      dropzone.classList.remove("is-dragover");
    });

    dropzone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropzone.classList.remove("is-dragover");
      input.files = e.dataTransfer.files;
      render(input.files);
    });

    // =========================
    // 2) ì˜µì…˜ ì¶”ê°€/ì‚­ì œ + ì¬ê³  ë¹„í™œì„±í™”
    // =========================
    const optionList = document.getElementById("optionList");
    const addBtn = document.getElementById("addOptionBtn");
    const stockInput = document.getElementById("stock");

    function syncStockState() {
      // ì˜µì…˜ ì…ë ¥ì¹¸ì´ í•˜ë‚˜ë¼ë„ "ê°’ì´ ìˆìœ¼ë©´" ì¬ê³ (stock) ë¹„í™œì„±í™”
      const optionNameInputs = optionList.querySelectorAll('input[name$=".option_name"]');
      const hasAnyOption = Array.from(optionNameInputs).some(inp => inp.value.trim().length > 0);

      if (hasAnyOption) {
        stockInput.value = "";        // ê¸°ì¡´ê°’ ì´ˆê¸°í™”
        stockInput.disabled = true;
      } else {
        stockInput.disabled = false;
      }
    }

    function reindexOptions() {
      Array.from(optionList.children).forEach((row, i) => {
        row.querySelector("label").textContent = `ì˜µì…˜ ${i + 1}`;
        row.querySelector('input[name$=".option_name"]').name = `options[${i}].option_name`;
        row.querySelector('input[name$=".stock"]').name = `options[${i}].stock`;
      });
    }

    function addOptionRow() {
      const idx = optionList.children.length;

      const row = document.createElement("div");
      row.className = "form-row";
      row.innerHTML = `
      <label class="form-label">ì˜µì…˜ ${idx + 1}</label>
      <div style="display:flex; gap:10px; align-items:center;">
        <input class="form-input small" name="options[${idx}].option_name"
               type="text" placeholder="ì˜ˆ: BLACK">
        <input class="form-input small" name="options[${idx}].stock"
               type="number" min="0" step="1" placeholder="ì¬ê³ ">
        <button type="button" class="btn btn-ghost removeBtn">ì‚­ì œ</button>
      </div>
    `;

      // ì˜µì…˜ ê°’ì´ ë°”ë€Œë©´ ì¬ê³  disable ì²´í¬
      row.querySelector('input[name$=".option_name"]').addEventListener("input", syncStockState);

      // ì‚­ì œ ë²„íŠ¼
      row.querySelector(".removeBtn").addEventListener("click", () => {
        row.remove();
        reindexOptions();
        syncStockState();
      });

      optionList.appendChild(row);
      syncStockState();
    }

    addBtn.addEventListener("click", addOptionRow);

    // ì²˜ìŒ í•œ ì¤„ ê¸°ë³¸ ìƒì„±
    addOptionRow();
  });
</script>


</body>
</html>